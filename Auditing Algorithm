Option Compare Text

Sub Analyze()


    Application.ScreenUpdating = False
    Application.AskToUpdateLinks = False
    Application.DisplayAlerts = False
    Dim dict As New Scripting.Dictionary
    Dim i As Integer
    Dim fTicket As String
    Dim empNum As String
    Dim j As Integer
    Dim rng As Range
    Dim empCell As Range
    Dim jobCode As Range
    Dim hourCount As Range
    Dim hourInt As Integer
    Dim hourErrors As Integer
    Dim sumJob
    Dim smcCell As Range
    Dim smcErrors As Integer
    Dim otrExist As Integer
    Dim jtExist As Integer
    Dim smcRef As String
    Dim tableRef As Integer
    Dim gt1 As String
    Dim gt2 As String
    Dim ftd1 As String
    Dim ftd2 As String
    Dim auditname As String
    
    With ThisWorkbook.Sheets(1)
    
    .Cells(1, 1) = "Ft#"
    .Cells(1, 2) = "Ft Desc."
    .Cells(1, 3) = "SMC's Match?"
    .Cells(1, 4) = "Hours Match?"
    .Cells(1, 5) = "OT Exists?"
    .Cells(1, 6) = "JT Exist?"
    .Cells(1, 7) = "Ft Desc match?"
    .Cells(1, 8) = "Date Match?"
    .Range("A1:H1").Font.FontStyle = "Bold"
    
    End With
    
    auditname = InputBox("Ensure Audit Sheet (Discoverer Data) is open. Enter the name of the audit sheet with extension (i.e. 'aaaa.xlsx'). The name of the sheet containing the pivot table should be named 'Audit'.")
    
    
    
    For n = 2 To ThisWorkbook.Worksheets.Count
    
    jtExist = 0
    otrExist = 0
    smcErrors = 0
    hourErrors = 0
    Application.ScreenUpdating = False
    
    
    fTicket = ThisWorkbook.Sheets(n).Cells(16, 30)
    ftd1 = ThisWorkbook.Sheets(n).Cells(9, 24)

    
    Windows(auditname).Activate
    Worksheets("Audit").Activate
    
    ActiveSheet.PivotTables("PivotTable1").PivotFields("Field Ticket Number").CurrentPage = fTicket
    
    hourInt = 2
    
    For Each empCell In ThisWorkbook.Sheets(n).Range("C16:C37")
    
    
    dict.RemoveAll
    
    If empCell.Value = "" Then
    
    
    
    Else
    empNum = empCell.Value
    
    For Each jobCode In ThisWorkbook.Sheets(n).Range("K14:S14")
        If jobCode.Value = "" Then
        Else
        dict(jobCode.Value) = 0
        End If
    Next
    
    ThisWorkbook.Activate
    
    
    ThisWorkbook.Sheets(n).Activate
    smcRef = ThisWorkbook.Sheets(n).Cells(empCell.Row, 6)
    
    
    For Each hourCount In ThisWorkbook.Sheets(n).Range(Cells(empCell.Row, 11), Cells(empCell.Row, 19))
    
        If hourCount.Value = "" Then
        Else
        dict(ThisWorkbook.Sheets(n).Cells(empCell.Row - hourInt, hourCount.Column).Value) = _
        dict(ThisWorkbook.Sheets(n).Cells(empCell.Row - hourInt, hourCount.Column).Value) + hourCount
        End If
        Next
    
    hourInt = hourInt + 1

    Windows(auditname).Activate
    Worksheets("Audit").Activate
    
    gt1 = ActiveSheet.Cells(ActiveSheet.Range("A1:A30").Find("Grand Total").Row, ActiveSheet.Range("A4:Z4").Find("Grand Total").Column)
    date1 = ThisWorkbook.Sheets(n).Cells(16, 25)
    gt2 = ThisWorkbook.Sheets(n).Cells(39, 20)
    
    For Each cell In ActiveSheet.Range("A4:Z4")
    If cell.Value Like "*description*" Then
    ftd2 = ActiveSheet.Cells(cell.Row + 1, cell.Column)
    End If
    If cell.Value Like "*date*" Then
    date2 = ActiveSheet.Cells(cell.Row + 1, cell.Column)
    End If
    Next
    
    
    
    For Each Key In dict.Keys
   
        If dict(Key) = ActiveSheet.Cells(ActiveSheet.Range("A4:A30").Find(empNum).Row, _
        ActiveSheet.Range("A4:Z4").Find(Key).Column) And gt1 = gt2 Then
        hourErrors = hourErrors + 0
        Else
        hourErrors = hourErrors + 1
        End If
        Next
     
        'If n = 3 Then
        'MsgBox (smcRef)
        'MsgBox (ActiveSheet.Cells(ActiveSheet.Range("A4:A30").Find(empNum).Row, 3))
        'End If
        
        If smcRef = ActiveSheet.Cells(ActiveSheet.Range("A4:A30").Find(empNum).Row, 3) Then
        smcErrors = smcErrors + 0
        Else
        smcErrors = smcErrors + 1
        End If
        
        
        'ThisWorkbook.Activate
        'ThisWorkbook.Sheets(n).Activate
        
        
        If ThisWorkbook.Sheets(n).Cells(empCell.Row, 5) Like "*jt*" Then
        jtExist = jtExist + 1
        End If
        
        If ThisWorkbook.Sheets(n).Cells(empCell.Row, 9) Like "*ot*" Then
        otrExist = otrExist + 1
        End If
        
      
        
        
        
    End If
    
    Next
    
    With ThisWorkbook.Sheets(1)
    
    .Cells(n, 1) = fTicket
    .Cells(n, 2) = ThisWorkbook.Sheets(n).Name
    
    If smcErrors > 0 Then
    .Cells(n, 3) = False
    Else
    .Cells(n, 3) = True
    End If
    
    If hourErrors = 0 And gt1 = gt2 Then
    .Cells(n, 4) = True
    Else
    .Cells(n, 4) = False
    End If
    
    If otrExist > 0 Then
    .Cells(n, 5) = True
    Else
    .Cells(n, 5) = False
    End If
    
    If jtExist > 0 Then
    .Cells(n, 6) = True
    Else
    .Cells(n, 6) = False
    End If
    
    If ftd1 = ftd2 Then
    .Cells(n, 7) = True
    Else
    .Cells(n, 7) = False
    End If
    
    If date1 = date2 Then
    .Cells(n, 8) = True
    Else
    .Cells(n, 8) = False
    End If
    
    End With
    
    
    Next
    
    Application.ScreenUpdating = True
    Application.AskToUpdateLinks = True
    Application.DisplayAlerts = True
    ThisWorkbook.Activate
    ThisWorkbook.Sheets(1).Activate
    ThisWorkbook.Sheets(1).Select
    
    
    
    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
   ' Windows("Book2.xlsm").Activate
End Sub
